name: Discord PR Notification

on:
  pull_request_target:
    branches:
      - develop
      - main
    types: [opened, synchronize, reopened, closed]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    env:
      DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
    steps:
      - name: Send PR embed message to Discord (only trusted users)
        if: |
          github.actor == 'taejun0' ||
          github.actor == 'sem201' ||
          github.actor == 'pedro0527' ||
          github.actor == 'nicerjs23' ||
          github.actor == 'gn00py48'
        run: |
          ACTION_TYPE="${{ github.event.action }}"
          IS_MERGED="${{ github.event.pull_request.merged }}"
          BASE_BRANCH="${{ github.event.pull_request.base.ref }}"

          TITLE="ğŸ“Œ PR ì´ë²¤íŠ¸: ${{ github.event.pull_request.title }}"
          COLOR=15844367  # ì£¼í™©

          if [ "$ACTION_TYPE" = "closed" ] && [ "$IS_MERGED" = "true" ]; then
            if [ "$BASE_BRANCH" = "main" ]; then
              TITLE="ğŸ‰ ğŸš€ **ë°°í¬ ì™„ë£Œ! (main ë¨¸ì§€)**: ${{ github.event.pull_request.title }}"
              COLOR=5763719  # íŒŒë‘
            else
              TITLE="âœ… PR ë¨¸ì§€ ì™„ë£Œ: ${{ github.event.pull_request.title }}"
              COLOR=3066993  # ì´ˆë¡
            fi
          fi

          curl -H "Content-Type: application/json" \
               -X POST "$DISCORD_WEBHOOK" \
               -d "{
                \"username\": \"GitHub Actions\",
                \"avatar_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\",
                \"embeds\": [{
                  \"title\": \"${TITLE}\",
                  \"color\": ${COLOR},
                  \"fields\": [
                    {
                      \"name\": \"ğŸ“‚ ë¸Œëœì¹˜\",
                      \"value\": \"${{ github.event.pull_request.head.ref }} â†’ ${{ github.event.pull_request.base.ref }}\"
                    },
                    {
                      \"name\": \"ğŸ‘¤ ì‘ì„±ì\",
                      \"value\": \"${{ github.actor }}\",
                      \"inline\": true
                    },
                    {
                      \"name\": \"ğŸ”— PR ë§í¬\",
                      \"value\": \"[PR ë³´ê¸°](${{ github.event.pull_request.html_url }})\"
                    }
                  ],
                  \"timestamp\": \"$(date --iso-8601=seconds)\"
                }]
              }"
